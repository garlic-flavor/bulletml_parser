// Generated by CoffeeScript 1.9.3
$(function() {
  var $lp, appendMembersMembers, appendToModulesList, getModuleMembers, isVisible, maxlp, setActiveModule, setPosition;
  $lp = $("#left-pain");
  maxlp = 0;
  isVisible = function(e) {
    var $e;
    $e = $(e);
    return (0 < $e.prop("offsetWidth")) || (0 < $e.prop("offsetHeight"));
  };
  appendToModulesList = function(e, title) {
    var $a, $div, $e, $expand;
    $e = $(e);
    $div = $("<div>");
    $div.attr("name", $e.attr("id"));
    if (title == null) {
      $expand = $("<div>");
      $expand.text("+");
      $expand.addClass("expand-button");
      $expand.click(function(e) {
        var $t, $ul;
        $t = $(e.target);
        if ("+" === $t.text()) {
          $ul = $div.children("ul");
          if (0 === $ul.length) {
            $div.append(getModuleMembers($e));
          } else {
            $ul.show();
          }
          return $t.text("-");
        } else {
          $div.children("ul").hide();
          return $t.text("+");
        }
      });
      $div.append($expand);
    }
    if (title == null) {
      title = $e.attr("id");
    }
    $a = $("<a>");
    $a.attr("href", "#" + $e.attr("id"));
    $a.text(title);
    $div.append($a);
    return $lp.append($div);
  };
  setPosition = function() {
    var left;
    if (isVisible($lp)) {
      $lp.innerWidth(maxlp + $lp.outerWidth() - $lp.prop("clientWidth"));
      left = $lp.offset().left + $lp.outerWidth();
      ($("#main-pain")).css("left", left);
      return ($("#main-title")).css("margin-left", left);
    } else {
      ($("#main-pain")).css("left", 0);
      return ($("#main-title")).css("margin-left", 0);
    }
  };
  setActiveModule = function() {
    var found, wh;
    $lp.children().removeClass("active");
    found = false;
    wh = ($(window)).innerHeight();
    return ($("#modules")).children("dt").each(function(i, e) {
      var rc, ref;
      rc = (ref = ($(e)).next()[0]) != null ? ref.getBoundingClientRect() : void 0;
      if (!found && rc.top < wh && 0 <= rc.bottom) {
        found = true;
        return $lp.children("[name='" + e.id + "']").addClass("active");
      }
    });
  };
  getModuleMembers = function(e) {
    var $e, $ul;
    $e = ($(e)).next("dd");
    $ul = $("<ul>");
    return appendMembersMembers($ul, $e.children("dl.module-members-sec"));
  };
  appendMembersMembers = function($ul, $elems) {
    $elems.each(function(_, e) {
      return ($(e)).children("dt").each(function(_, e2) {
        var $a, $decl, $e2, $li, $ul2, l, name, nname;
        $e2 = $(e2);
        $decl = $e2.find("a.anchor:first");
        $li = $("<li>");
        $a = $("<a>");
        name = $decl.attr("name");
        l = name.indexOf(".");
        if (0 < l) {
          nname = name.substring(l + 1);
          if (isNaN(parseInt(nname))) {
            name = nname;
          } else {
            name = name.substring(0, l);
          }
        }
        $a.text(name);
        $a.attr("href", "#" + $decl.attr("id"));
        $li.append($a);
        $ul.append($li);
        $ul2 = $("<ul>");
        appendMembersMembers($ul2, $e2.next("dd").children("dl.members-sec"));
        return $ul.append($ul2);
      });
    });
    return $ul;
  };
  ($(window)).resize(function() {
    return setPosition();
  });
  ($(window)).scroll(function() {
    return setActiveModule();
  });
  (function() {
    var $btn;
    $btn = $("<button>");
    $btn.text("-");
    $btn.css({
      position: "fixed",
      left: "0",
      top: "0"
    });
    $btn.click(function() {
      if ($btn.text() === "-") {
        $lp.hide();
        $btn.text("+");
      } else {
        $lp.show();
        $btn.text("-");
      }
      return setPosition();
    });
    $btn.appendTo(document.body);
    return $lp.css("top", $btn.outerHeight());
  })();
  $("#modules > dd:first .summary-header-sec").show();
  ($("#modules")).children("dt").each(function(_, e) {
    return appendToModulesList(e);
  });
  maxlp = $lp.outerWidth();
  setPosition();
  return setActiveModule();
});
